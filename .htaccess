# Active le moteur de rÃ©Ã©criture d'URL
RewriteEngine on

# ðŸ”¹ Forcer l'utilisation de HTTPS
RewriteCond %{HTTPS} !=on
RewriteRule .* https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# DÃ©finit la base des rÃ©Ã©critures d'URL
RewriteBase /

# ðŸ”¹ RÃ¨gle 1 : Rediriger toutes les requÃªtes contenant "/public/" dans l'URL
# Cela Ã©vite que l'utilisateur voit "/public/" dans l'URL lorsqu'il accÃ¨de au site.
RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /public/.*\ HTTPS/
RewriteRule ^/(.*)$ uxseo.fr/$1 [R=301,L]

# ðŸ”¹ RÃ¨gle 2 : Redirection de www vers non-www
# Si l'utilisateur tape "www.uxseo.fr", il sera redirigÃ© vers "uxseo.fr"
RewriteCond %{HTTP_HOST} ^www\.uxseo\.fr [NC]
RewriteRule ^(.*)$ https://uxseo.fr/$1 [R=301,L]

# ðŸ”¹ RÃ¨gle 3 : RÃ©Ã©crire les URLs pour Ã©viter d'afficher "/public/"
# Si l'URL ne contient pas dÃ©jÃ  "/public/", elle est rÃ©Ã©crite pour pointer vers ce dossier
RewriteCond %{REQUEST_URI} !^/public/
RewriteRule ^(.*)$ /public/$1 [L]

# ðŸ”¹ Gestion des fichiers et rÃ©Ã©criture des requÃªtes non existantes vers index.php
<IfModule mod_rewrite.c>
    Options -MultiViews
    RewriteEngine On

    # Si le fichier demandÃ© n'existe pas, on redirige tout vers "index.php"
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^(.*)$ index.php [QSA,L]

    # EmpÃªche la rÃ©Ã©criture du fichier robots.txt
    RewriteRule ^robots.txt - [L]
</IfModule>

# ðŸ”¹ Gestion des redirections si mod_rewrite n'est pas disponible
<IfModule !mod_rewrite.c>
    <IfModule mod_alias.c>
        RedirectMatch 302 ^/$ /index.php/
    </IfModule>
</IfModule>

# ðŸ”¹ Configuration des en-tÃªtes de sÃ©curitÃ©
<IfModule mod_headers.c>
    # Politique de Referrer (limite l'envoi des informations de la page prÃ©cÃ©dente)
    Header set Referrer-Policy "same-origin"

    # SÃ©curisation contre les attaques de type man-in-the-middle
    Header set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

    # Protection contre les attaques MIME sniffing
    Header set X-Content-Type-Options "nosniff"

    # Protection contre le Clickjacking
    Header set X-Frame-Options "SAMEORIGIN"

    # Protection contre les attaques XSS (Cross-Site Scripting)
    Header set X-XSS-Protection "1; mode=block"

    # Politique de permissions pour certaines fonctionnalitÃ©s (gÃ©olocalisation, micro)
    Header set Permissions-Policy "geolocation=self https://uxseo.fr; microphone"

    # Politique de sÃ©curitÃ© pour le partage des ressources entre sites
    Header set Cross-Origin-Opener-Policy "same-origin|same-origin-allow-popups|unsafe-none; report-to=default"
    Header set Cross-Origin-Embedder-Policy-Report-Only "unsafe-none|require-corp; report-to=default"
</IfModule>
